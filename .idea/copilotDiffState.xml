<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/infohub_telas/model/SaldoInfoCash.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/infohub_telas/model/SaldoInfoCash.kt" />
              <option name="updatedContent" value="package com.example.infohub_telas.model&#10;&#10;import com.google.gson.annotations.SerializedName&#10;import java.util.Date&#10;&#10;/**&#10; * Modelo de resposta da API SaldoInfoCash&#10; */&#10;data class SaldoInfoCashResponse(&#10;    @SerializedName(&quot;id_usuario&quot;)&#10;    val idUsuario: Int,&#10;    &#10;    @SerializedName(&quot;saldo_total&quot;)&#10;    val saldoTotal: Int,&#10;    &#10;    @SerializedName(&quot;ultima_atualizacao&quot;)&#10;    val ultimaAtualizacao: String&#10;)&#10;&#10;/**&#10; * Modelo local com funcionalidades adicionais&#10; */&#10;data class SaldoInfoCash(&#10;    val idUsuario: Int,&#10;    val saldoTotal: Int,&#10;    val ultimaAtualizacao: String&#10;) {&#10;    fun getSaldoFormatado(): String = &quot;$saldoTotal HC&quot;&#10;    &#10;    fun getSaldoComVirgula(): String {&#10;        return if (saldoTotal &gt;= 1000) {&#10;            String.format(&quot;%,.0f HC&quot;, saldoTotal.toDouble()).replace(&quot;,&quot;, &quot;.&quot;)&#10;        } else {&#10;            &quot;$saldoTotal HC&quot;&#10;        }&#10;    }&#10;    &#10;    // Calcula progresso baseado no saldo (exemplo: a cada 500 HC = 1 nível)&#10;    fun getNivelAtual(): Int = (saldoTotal / 500) + 1&#10;    &#10;    fun getProgressoAtual(): Float {&#10;        val nivelAtual = getNivelAtual()&#10;        val pontosPorNivel = 500&#10;        val pontosNivelAtual = saldoTotal % pontosPorNivel&#10;        return pontosNivelAtual.toFloat() / pontosPorNivel.toFloat()&#10;    }&#10;    &#10;    fun getPontosParaProximoNivel(): Int {&#10;        val pontosPorNivel = 500&#10;        val pontosNivelAtual = saldoTotal % pontosPorNivel&#10;        return pontosPorNivel - pontosNivelAtual&#10;    }&#10;    &#10;    fun getNivelTexto(): String = &quot;Level ${getNivelAtual()}&quot;&#10;    &#10;    fun getMensagemProximoNivel(): String = &#10;        &quot;Faltam ${getPontosParaProximoNivel()} HC para o próximo nível&quot;&#10;    &#10;    companion object {&#10;        fun fromResponse(response: SaldoInfoCashResponse): SaldoInfoCash {&#10;            return SaldoInfoCash(&#10;                idUsuario = response.idUsuario,&#10;                saldoTotal = response.saldoTotal,&#10;                ultimaAtualizacao = response.ultimaAtualizacao&#10;            )&#10;        }&#10;        &#10;        // Dados mock para desenvolvimento/teste&#10;        fun getMockData(): SaldoInfoCash {&#10;            return SaldoInfoCash(&#10;                idUsuario = 1,&#10;                saldoTotal = 1285,&#10;                ultimaAtualizacao = &quot;2023-11-11T10:30:00.000Z&quot;&#10;            )&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/infohub_telas/telas/TelaCarrinho.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/infohub_telas/telas/TelaCarrinho.kt" />
              <option name="originalContent" value="package com.example.infohub_telas.telas&#10;&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.navigation.NavController&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.infohub_telas.components.BottomMenu&#10;import com.example.infohub_telas.components.CarrinhoCheio&#10;import com.example.infohub_telas.components.CarrinhoVazio&#10;import com.example.infohub_telas.components.Header&#10;import com.example.infohub_telas.navigation.Routes&#10;import com.example.infohub_telas.ui.theme.InfoHub_telasTheme&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun TelaCarrinho(navController: NavController) {&#10;    val context = LocalContext.current&#10;    val prefs = context.getSharedPreferences(&quot;auth&quot;, android.content.Context.MODE_PRIVATE)&#10;    val isAdmin = prefs.getBoolean(&quot;isAdmin&quot;, false)&#10;&#10;    // Estado para simular se o carrinho está vazio ou não&#10;    var carrinhoVazio by remember { mutableStateOf(false) }&#10;&#10;    fun navigateToCheckout() {&#10;        navController.navigate(Routes.CHECKOUT)&#10;    }&#10;&#10;    fun navigateToHome() {&#10;        navController.navigate(Routes.HOME) {&#10;            popUpTo(Routes.HOME) { inclusive = true }&#10;        }&#10;    }&#10;&#10;    fun navigateBack() {&#10;        navController.navigateUp()&#10;    }&#10;&#10;    Scaffold(&#10;        topBar = { Header(title = &quot;Meu Carrinho&quot;, onBackClick = { navigateBack() }) },&#10;        bottomBar = { BottomMenu(navController = navController, isAdmin = isAdmin) }&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues)&#10;        ) {&#10;            if (carrinhoVazio) {&#10;                CarrinhoVazio(navController = navController)&#10;            } else {&#10;                CarrinhoCheio(navController = navController)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun TelaCarrinhoPreview() {&#10;    InfoHub_telasTheme {&#10;        TelaCarrinho(rememberNavController())&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.infohub_telas.telas&#10;&#10;import android.util.Log&#10;import android.widget.Toast&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import androidx.navigation.NavController&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.infohub_telas.components.BottomMenu&#10;import com.example.infohub_telas.components.CarrinhoCheio&#10;import com.example.infohub_telas.components.CarrinhoVazio&#10;import com.example.infohub_telas.components.Header&#10;import com.example.infohub_telas.navigation.Routes&#10;import com.example.infohub_telas.ui.theme.InfoHub_telasTheme&#10;import com.example.infohub_telas.viewmodel.CarrinhoUiState&#10;import com.example.infohub_telas.viewmodel.CarrinhoViewModel&#10;import com.example.infohub_telas.viewmodel.OperationUiState&#10;&#10;private const val TAG = &quot;TelaCarrinho&quot;&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun TelaCarrinho(navController: NavController) {&#10;    val context = LocalContext.current&#10;    val prefs = context.getSharedPreferences(&quot;auth&quot;, android.content.Context.MODE_PRIVATE)&#10;    val isAdmin = prefs.getBoolean(&quot;isAdmin&quot;, false)&#10;    val token = prefs.getString(&quot;token&quot;, &quot;&quot;) ?: &quot;&quot;&#10;    val userId = prefs.getInt(&quot;user_id&quot;, 0)&#10;&#10;    // ViewModel para gerenciar o carrinho&#10;    val viewModel: CarrinhoViewModel = viewModel()&#10;    val carrinhoState by viewModel.carrinhoState.collectAsState()&#10;    val operationState by viewModel.operationState.collectAsState()&#10;&#10;    // Carregar carrinho ao abrir a tela&#10;    LaunchedEffect(userId) {&#10;        Log.d(TAG, &quot; Iniciando TelaCarrinho - UserId: $userId&quot;)&#10;&#10;        if (token.isBlank()) {&#10;            Log.e(TAG, &quot;❌ Token de autenticação não encontrado&quot;)&#10;            Toast.makeText(context, &quot;Faça login para ver seu carrinho&quot;, Toast.LENGTH_LONG).show()&#10;        } else if (userId == 0) {&#10;            Log.e(TAG, &quot;❌ ID do usuário inválido&quot;)&#10;            Toast.makeText(context, &quot;Erro ao identificar usuário&quot;, Toast.LENGTH_LONG).show()&#10;        } else {&#10;            Log.d(TAG, &quot;✅ Carregando carrinho do usuário $userId&quot;)&#10;            viewModel.carregarCarrinho(token, userId)&#10;        }&#10;    }&#10;&#10;    // Observar estado das operações e mostrar feedback&#10;    LaunchedEffect(operationState) {&#10;        when (val state = operationState) {&#10;            is OperationUiState.Success -&gt; {&#10;                Log.d(TAG, &quot;✅ Operação bem-sucedida: ${state.message}&quot;)&#10;                Toast.makeText(context, state.message, Toast.LENGTH_SHORT).show()&#10;                viewModel.resetOperationState()&#10;            }&#10;            is OperationUiState.Error -&gt; {&#10;                Log.e(TAG, &quot;❌ Erro na operação: ${state.message}&quot;)&#10;                Toast.makeText(context, &quot;Erro: ${state.message}&quot;, Toast.LENGTH_LONG).show()&#10;                viewModel.resetOperationState()&#10;            }&#10;            else -&gt; {&#10;                // Idle ou Loading - não fazer nada&#10;            }&#10;        }&#10;    }&#10;&#10;    fun navigateToCheckout() {&#10;        Log.d(TAG, &quot; Navegando para Checkout&quot;)&#10;        navController.navigate(Routes.CHECKOUT)&#10;    }&#10;&#10;    fun navigateToHome() {&#10;        Log.d(TAG, &quot; Navegando para Home&quot;)&#10;        navController.navigate(Routes.HOME) {&#10;            popUpTo(Routes.HOME) { inclusive = true }&#10;        }&#10;    }&#10;&#10;    fun navigateBack() {&#10;        Log.d(TAG, &quot;⬅️ Voltando para tela anterior&quot;)&#10;        navController.navigateUp()&#10;    }&#10;&#10;    Scaffold(&#10;        topBar = { Header(title = &quot;Meu Carrinho&quot;, onBackClick = { navigateBack() }) },&#10;        bottomBar = { BottomMenu(navController = navController, isAdmin = isAdmin) }&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues)&#10;        ) {&#10;            // Renderizar baseado no estado da API&#10;            when (val state = carrinhoState) {&#10;                is CarrinhoUiState.Loading -&gt; {&#10;                    // Estado de carregamento&#10;                    Log.d(TAG, &quot;⏳ Estado: Loading - Carregando carrinho...&quot;)&#10;                    Box(&#10;                        modifier = Modifier.fillMaxSize(),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        CircularProgressIndicator()&#10;                    }&#10;                }&#10;                &#10;                is CarrinhoUiState.Success -&gt; {&#10;                    val itens = state.itens&#10;                    val valorTotal = state.valorTotal&#10;                    &#10;                    Log.d(TAG, &quot;✅ Estado: Success - ${itens.size} itens, Total: R$ $valorTotal&quot;)&#10;                    &#10;                    if (itens.isEmpty()) {&#10;                        // Carrinho vazio&#10;                        Log.d(TAG, &quot; Carrinho vazio - Mostrando CarrinhoVazio&quot;)&#10;                        CarrinhoVazio(navController = navController)&#10;                    } else {&#10;                        // Carrinho com itens&#10;                        Log.d(TAG, &quot; Carrinho com ${itens.size} itens - Mostrando CarrinhoCheio&quot;)&#10;                        CarrinhoCheio(navController = navController)&#10;                    }&#10;                }&#10;                &#10;                is CarrinhoUiState.Error -&gt; {&#10;                    // Estado de erro - mostrar carrinho vazio como fallback&#10;                    Log.e(TAG, &quot;❌ Estado: Error - ${state.message}&quot;)&#10;                    Log.e(TAG, &quot;⚠️ Mostrando CarrinhoVazio como fallback devido ao erro&quot;)&#10;                    &#10;                    // Mostrar toast com erro&#10;                    LaunchedEffect(state.message) {&#10;                        Toast.makeText(&#10;                            context,&#10;                            &quot;Erro ao carregar carrinho: ${state.message}&quot;,&#10;                            Toast.LENGTH_LONG&#10;                        ).show()&#10;                    }&#10;                    &#10;                    CarrinhoVazio(navController = navController)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun TelaCarrinhoPreview() {&#10;    InfoHub_telasTheme {&#10;        TelaCarrinho(rememberNavController())&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>