# üìö **InfoHub API - Documenta√ß√£o Completa**

## üéØ **Sistema de E-commerce Completo**

### **Base URL:** `http://localhost:8080/v1/infohub`

> **‚ö†Ô∏è IMPORTANTE - Atualiza√ß√µes 27/11/2025:**
> - ‚úÖ **Erro 500 no sistema de posts foi CORRIGIDO**
> - ‚úÖ **DAO de posts refatorado com prepared statements**
> - ‚úÖ **Seguran√ßa contra SQL injection implementada**
> - ‚úÖ **Campos da tabela tbl_post alinhados com o c√≥digo**
> - ‚úÖ **Campo IMAGEM adicionado aos produtos**
> - ‚úÖ **Sistema funcionando perfeitamente**

---

## üì± **Rede Social - Posts**

### **Criar Post**
```http
POST /posts
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 3,
  "conteudo": "Compartilhando minha experi√™ncia com este produto incr√≠vel!",
  "titulo": "Produto Recomendado",
  "imagem": "https://exemplo.com/imagem.jpg"
}
```

### **Listar Feed de Posts**
```http
GET /posts/feed
Authorization: Bearer <token>
```

### **Listar Feed com Pagina√ß√£o**
```http
GET /posts/feed/{page}/{limit}
Authorization: Bearer <token>
```

### **Listar Posts do Usu√°rio**
```http
GET /posts/usuario/{id_usuario}
Authorization: Bearer <token>
```

### **Listar Posts do Usu√°rio com Pagina√ß√£o**
```http
GET /posts/usuario/{id_usuario}/{page}/{limit}
Authorization: Bearer <token>
```

### **Buscar Post por ID**
```http
GET /posts/{id_post}
Authorization: Bearer <token>
```

### **Atualizar Post**
```http
PUT /posts/{id_post}
Authorization: Bearer <token>
Content-Type: application/json

{
  "conteudo": "Conte√∫do atualizado do post",
  "titulo": "Novo t√≠tulo"
}
```

### **Deletar Post**
```http
DELETE /posts/{id_post}
Authorization: Bearer <token>
```

### **Curtir/Descurtir Post**
```http
POST /posts/{id_post}/curtir
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 3
}
```

### **Verificar se Usu√°rio Curtiu**
```http
GET /posts/{id_post}/curtida/{id_usuario}
Authorization: Bearer <token>
```

### **Comentar em Post**
```http
POST /posts/{id_post}/comentarios
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 3,
  "conteudo": "√ìtimo post! Concordo totalmente."
}
```

### **Listar Coment√°rios do Post**
```http
GET /posts/{id_post}/comentarios
Authorization: Bearer <token>
```

### **Atualizar Coment√°rio**
```http
PUT /comentarios/{id_comentario}
Authorization: Bearer <token>
Content-Type: application/json

{
  "conteudo": "Coment√°rio atualizado"
}
```

### **Deletar Coment√°rio**
```http
DELETE /comentarios/{id_comentario}
Authorization: Bearer <token>
```

---

## üì¶ **Produtos**

### **Criar Produto**
```http
POST /produtos
Authorization: Bearer <token>
Content-Type: application/json

{
  "nome": "iPhone 15 Pro",
  "descricao": "Smartphone Apple mais recente",
  "id_categoria": 5,
  "id_estabelecimento": 2,
  "preco": 8999.99,
  "imagem": "https://exemplo.com/iphone15pro.jpg"
}
```

### **Listar Todos os Produtos**
```http
GET /produtos
# P√∫blico - sem autentica√ß√£o
```

### **Buscar Produto por ID**
```http
GET /produtos/{id_produto}
# P√∫blico - sem autentica√ß√£o
```

### **Atualizar Produto**
```http
PUT /produtos/{id_produto}
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_produto": 10,
  "nome": "iPhone 15 Pro - Atualizado",
  "descricao": "Descri√ß√£o atualizada",
  "id_categoria": 5,
  "id_estabelecimento": 2,
  "preco": 7999.99,
  "imagem": "https://exemplo.com/nova-imagem.jpg"
}
```

### **Deletar Produto**
```http
DELETE /produtos/{id_produto}
Authorization: Bearer <token>
```

---

## üõçÔ∏è **Carrinho de Compras**

### **Adicionar Item ao Carrinho**
```http
POST /carrinho
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 1,
  "id_produto": 5,
  "quantidade": 2
}
```

### **Listar Carrinho do Usu√°rio**
```http
GET /carrinho/{id_usuario}
Authorization: Bearer <token>
```

### **Atualizar Quantidade no Carrinho**
```http
PUT /carrinho
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 1,
  "id_produto": 5,
  "quantidade": 3
}
```

### **Remover Item do Carrinho**
```http
DELETE /carrinho/{id_usuario}/{id_produto}
Authorization: Bearer <token>
```

### **Limpar Carrinho Completo**
```http
DELETE /carrinho/{id_usuario}
Authorization: Bearer <token>
```

### **Contar Itens no Carrinho**
```http
GET /carrinho/{id_usuario}/count
Authorization: Bearer <token>
```

### **Calcular Total do Carrinho**
```http
GET /carrinho/{id_usuario}/total
Authorization: Bearer <token>
```

---

## üí≥ **Compras**

### **Processar Compra do Carrinho**
```http
POST /compra/carrinho
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 1,
  "id_estabelecimento": 2,
  "metodo_pagamento": "cartao",
  "dados_cartao": {
    "numero": "1234567890123456",
    "cvv": "123"
  }
}
```

### **Listar Compras do Usu√°rio**
```http
GET /compras/usuario/{id_usuario}
Authorization: Bearer <token>
```

### **Buscar Compra Espec√≠fica**
```http
GET /compra/{id_compra}
Authorization: Bearer <token>
```

### **Listar Todas as Compras (Admin)**
```http
GET /compras
Authorization: Bearer <admin_token>
```

### **Listar Compras por Status (Admin)**
```http
GET /compras/status/{status}
Authorization: Bearer <admin_token>
```
**Status v√°lidos:** `pendente`, `confirmada`, `processando`, `enviada`, `entregue`, `cancelada`

### **Atualizar Status da Compra (Admin)**
```http
PUT /compra/{id_compra}/status
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "status": "confirmada"
}
```

### **Cancelar Compra**
```http
PUT /compra/{id_compra}/cancelar
Authorization: Bearer <token>
```

---

## ‚ù§Ô∏è **Favoritos**

### **Adicionar aos Favoritos**
```http
POST /favoritos
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 1,
  "id_produto": 5
}
```

### **Alternar Favorito (Add/Remove)**
```http
POST /favoritos/toggle
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 1,
  "id_produto": 5
}
```

### **Listar Favoritos do Usu√°rio**
```http
GET /favoritos/{id_usuario}
Authorization: Bearer <token>
```

### **Verificar se √© Favorito**
```http
GET /favoritos/{id_usuario}/{id_produto}/check
Authorization: Bearer <token>
```

### **Favoritos em Promo√ß√£o**
```http
GET /favoritos/{id_usuario}/promocoes
Authorization: Bearer <token>
```

### **Produtos Mais Favoritados**
```http
GET /favoritos/mais-favoritados/{limit}
# P√∫blico - sem autentica√ß√£o
```

### **Contar Favoritos**
```http
GET /favoritos/{id_usuario}/count
Authorization: Bearer <token>
```

### **Remover dos Favoritos**
```http
DELETE /favoritos/{id_usuario}/{id_produto}
Authorization: Bearer <token>
```

---

## üîî **Notifica√ß√µes**

### **Listar Notifica√ß√µes do Usu√°rio**
```http
GET /notificacoes/{id_usuario}?limit=20
Authorization: Bearer <token>
```

### **Notifica√ß√µes N√£o Lidas**
```http
GET /notificacoes/{id_usuario}/nao-lidas
Authorization: Bearer <token>
```

### **Contar N√£o Lidas**
```http
GET /notificacoes/{id_usuario}/count
Authorization: Bearer <token>
```

### **Marcar Como Lida**
```http
PUT /notificacoes/{id_notificacao}/lida
Authorization: Bearer <token>
```

### **Marcar Todas Como Lidas**
```http
PUT /notificacoes/{id_usuario}/marcar-todas-lidas
Authorization: Bearer <token>
```

### **Notifica√ß√µes por Tipo**
```http
GET /notificacoes/{id_usuario}/tipo/{tipo}
Authorization: Bearer <token>
```
**Tipos:** `promocao`, `alerta`, `social`, `compra`, `carrinho`

### **Deletar Notifica√ß√£o**
```http
DELETE /notificacoes/{id_notificacao}
Authorization: Bearer <token>
```

### **Criar Notifica√ß√£o (Admin)**
```http
POST /notificacoes
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "id_usuario": 1,
  "mensagem": "Sua promo√ß√£o favorita est√° ativa!",
  "tipo": "promocao"
}
```

---

## ‚≠ê **Avalia√ß√µes**

### **Criar Avalia√ß√£o**
```http
POST /avaliacoes
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 1,
  "id_produto": 5,
  "nota": 4,
  "comentario": "Produto muito bom!"
}
```

### **Avaliar Estabelecimento**
```http
POST /avaliacoes
Authorization: Bearer <token>
Content-Type: application/json

{
  "id_usuario": 1,
  "id_estabelecimento": 2,
  "nota": 5,
  "comentario": "Atendimento excelente!"
}
```

### **Listar Avalia√ß√µes de Produto**
```http
GET /avaliacoes/produto/{id_produto}
# P√∫blico
```

### **Listar Avalia√ß√µes de Estabelecimento**
```http
GET /avaliacoes/estabelecimento/{id_estabelecimento}
# P√∫blico
```

### **Avalia√ß√µes do Usu√°rio**
```http
GET /avaliacoes/usuario/{id_usuario}
Authorization: Bearer <token>
```

### **Estat√≠sticas de Produto**
```http
GET /avaliacoes/produto/{id_produto}/estatisticas
# P√∫blico
```

### **Estat√≠sticas de Estabelecimento**
```http
GET /avaliacoes/estabelecimento/{id_estabelecimento}/estatisticas
# P√∫blico
```

### **Produtos Mais Bem Avaliados**
```http
GET /avaliacoes/produtos/mais-bem-avaliados/{limit}
# P√∫blico
```

### **Verificar se Pode Avaliar**
```http
GET /avaliacoes/pode-avaliar/{id_usuario}/{id_produto}
Authorization: Bearer <token>
```

### **Atualizar Avalia√ß√£o**
```http
PUT /avaliacoes/{id_avaliacao}
Authorization: Bearer <token>
Content-Type: application/json

{
  "nota": 5,
  "comentario": "Mudei de opini√£o, produto excelente!"
}
```

### **Deletar Avalia√ß√£o**
```http
DELETE /avaliacoes/{id_avaliacao}
Authorization: Bearer <token>
```

---

## üë• **Tipos de Usu√°rio e Permiss√µes**

### **Consumidor (Padr√£o)**
- ‚úÖ Gerenciar pr√≥prio carrinho e favoritos
- ‚úÖ Fazer compras e avaliar produtos
- ‚úÖ Ver pr√≥prias notifica√ß√µes e compras
- ‚ùå N√£o pode acessar dados de outros usu√°rios

### **Administrador**
- ‚úÖ Acesso total a todas as funcionalidades
- ‚úÖ Gerenciar compras de todos os usu√°rios
- ‚úÖ Criar notifica√ß√µes e produtos
- ‚úÖ Ver relat√≥rios e estat√≠sticas globais

### **Estabelecimento**
- ‚úÖ Gerenciar produtos e promo√ß√µes
- ‚úÖ Atualizar status de compras
- ‚úÖ Ver compras do estabelecimento
- ‚ùå Acesso limitado comparado ao admin

---

## üìä **Exemplos de Resposta**

### **Sucesso - Post Criado**
```json
{
  "status": true,
  "status_code": 201,
  "message": "Post criado com sucesso.",
  "data": {
    "id_post": 2,
    "id_usuario": 3,
    "titulo": null,
    "conteudo": "teste 333\n\nfazendo o teste para ver se vai dar certo",
    "imagem": null,
    "data_criacao": "2025-11-27T00:18:35.000Z"
  }
}
```

### **Sucesso - Produto com Imagem**
```json
{
  "status": true,
  "status_code": 200,
  "produtos": [
    {
      "id_produto": 10,
      "nome": "iPhone 15 Pro",
      "descricao": "Smartphone Apple mais recente",
      "id_categoria": 5,
      "imagem": "https://exemplo.com/iphone15pro.jpg",
      "categoria": "Eletr√¥nicos",
      "preco": "8999.99",
      "id_estabelecimento": 2,
      "preco_promocional": null,
      "data_inicio": null,
      "data_fim": null
    }
  ]
}
```

### **Sucesso - Carrinho**
```json
{
  "status": true,
  "status_code": 200,
  "message": "Carrinho encontrado com sucesso.",
  "data": {
    "itens": [
      {
        "id_carrinho": 1,
        "id_produto": 5,
        "nome_produto": "Leite Integral 1L",
        "quantidade": 2,
        "preco_atual": "4.99",
        "preco_promocional": "3.99"
      }
    ],
    "resumo": {
      "total_itens": 1,
      "total_produtos": 2,
      "valor_total": "7.98"
    }
  }
}
```

### **Sucesso - Compra Processada**
```json
{
  "status": true,
  "status_code": 201,
  "message": "Compra processada com sucesso.",
  "data": {
    "id_compra": 15,
    "id_usuario": 1,
    "valor_total": "25.90",
    "status_compra": "pendente",
    "data_compra": "2025-11-11T10:30:00.000Z"
  }
}
```

### **Erro - Valida√ß√£o**
```json
{
  "status": false,
  "status_code": 400,
  "message": "Campos 'id_usuario' e 'id_produto' s√£o obrigat√≥rios."
}
```

### **Erro - Permiss√£o**
```json
{
  "status": false,
  "status_code": 403,
  "message": "Acesso negado. Apenas administradores podem acessar esta funcionalidade."
}
```

---

## üîÑ **Fluxo Completo de Compra**

1. **Adicionar produtos ao carrinho**
   ```http
   POST /carrinho
   ```

2. **Verificar carrinho e total**
   ```http
   GET /carrinho/{id_usuario}
   GET /carrinho/{id_usuario}/total
   ```

3. **Processar compra**
   ```http
   POST /compra/carrinho
   ```

4. **Acompanhar status**
   ```http
   GET /compra/{id_compra}
   ```

5. **Receber notifica√ß√µes**
   ```http
   GET /notificacoes/{id_usuario}/nao-lidas
   ```

6. **Avaliar produto/estabelecimento**
   ```http
   POST /avaliacoes
   ```

---

## üöÄ **Recursos Autom√°ticos**

### **Notifica√ß√µes Autom√°ticas**
- üî• Favoritos em promo√ß√£o
- üì¶ Status de compra alterado
- üõí Carrinho abandonado (24h)
- ‚úÖ Compra confirmada

### **Triggers do Banco**
- üîÑ C√°lculo autom√°tico de subtotais
- üì¢ Notifica√ß√£o quando favorito entra em promo√ß√£o
- üìä Atualiza√ß√£o de estat√≠sticas em tempo real

### **Seguran√ßa**
- üîê JWT para autentica√ß√£o
- üõ°Ô∏è Middlewares de permiss√£o
- üîí Valida√ß√£o de dados em todas as rotas
- üë§ Controle de acesso por tipo de usu√°rio

---

## üìã **C√≥digos de Status**

| C√≥digo | Significado | Quando Usar |
|--------|-------------|-------------|
| `200` | OK | Opera√ß√£o bem-sucedida |
| `201` | Created | Recurso criado com sucesso |
| `400` | Bad Request | Dados inv√°lidos ou faltando |
| `401` | Unauthorized | Token inv√°lido ou ausente |
| `403` | Forbidden | Sem permiss√£o para acessar |
| `404` | Not Found | Recurso n√£o encontrado |
| `409` | Conflict | Conflito (ex: item j√° nos favoritos) |
| `500` | Internal Error | Erro interno do servidor |

---

**üéâ Sistema completo implementado com:**
- ‚úÖ **Rede Social - Posts com coment√°rios e curtidas** *(CORRIGIDO - 27/11/2025)*
- ‚úÖ **Produtos com campo imagem** *(ADICIONADO - 27/11/2025)*
- ‚úÖ Carrinho de compras funcional
- ‚úÖ Sistema de compras com m√∫ltiplos status
- ‚úÖ Favoritos com notifica√ß√£o de promo√ß√µes
- ‚úÖ Sistema completo de notifica√ß√µes
- ‚úÖ Avalia√ß√µes de produtos e estabelecimentos
- ‚úÖ Controle de permiss√µes por tipo de usu√°rio
- ‚úÖ Integra√ß√£o com IA existente
- ‚úÖ Triggers autom√°ticos no banco de dados
- ‚úÖ Seguran√ßa com prepared statements (SQL injection prevention)